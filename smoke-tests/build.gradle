// TODO : convert to kotlin for consistency
plugins {
  id "java"
  alias gradlePlugins.plugins.taskinfo
}

dependencies {
  testImplementation("org.testcontainers:testcontainers:1.19.1")
  testImplementation("com.fasterxml.jackson.core:jackson-databind:2.15.2")
  testImplementation("com.google.protobuf:protobuf-java-util:3.24.2")
  testImplementation("com.squareup.okhttp3:okhttp:4.11.0")
  testImplementation("io.opentelemetry.proto:opentelemetry-proto:1.0.0-alpha")
  testImplementation("io.opentelemetry:opentelemetry-api")

  testImplementation("ch.qos.logback:logback-classic:1.4.11")

  testImplementation("org.assertj:assertj-core:3.24.2")
}

tasks.test {
  useJUnitPlatform()

  testLogging.showStandardStreams = true

  // ensure test application docker image is available locally with 'latest' tag
  dependsOn(":smoke-tests:test-app:assemble")

  // depends on packaged agent output file
  def agentShadowTask = project(":agent").tasks.shadowJar
  dependsOn(agentShadowTask)
  inputs.files(layout.files(agentShadowTask))

  doFirst {
    jvmArgs("-Dio.opentelemetry.smoketest.agent.shadowJar.path=${agentShadowTask.archiveFile.get()}")
  }
}
